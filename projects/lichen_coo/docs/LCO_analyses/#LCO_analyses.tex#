\documentclass[11pt]{amsart}
\usepackage{geometry}                % See geometry.pdf to learn the layout options. There are lots.
\geometry{letterpaper}                   % ... or a4paper or a5paper or ... 
%\geometry{landscape}                % Activate for for rotated page geometry
%\usepackage[parfill]{parskip}    % Activate to begin paragraphs with an empty line rather than an indent
\usepackage{graphicx}
\usepackage{amssymb}
\usepackage{epstopdf}
\DeclareGraphicsRule{.tif}{png}{.png}{`convert #1 `dirname #1`/`basename #1 .tif`.png}
\usepackage{/Library/Frameworks/R.framework/Resources/share/texmf/Sweave}

\title{Genotypic variation influences lichen co-occurrence network structure}
\author{M.K. Lau, L.J. Lamit, T.G. Whitham}
%\date{}                                           % Activate to display a given date or no date

\begin{document}
\maketitle

\section{Things to Do}
\begin{enumerate}
\item Integrate garden as a factor into analyses
\end{enumerate}

\section{Generate lichen network models for all genotypes in each garden}

\subsection{Load packages}

\begin{Schunk}
\begin{Sinput}
> require(sna)
> require(vegan)
> require(xtable)
> require(gplots)
> source("source/CorNets.R")
> se = function(x) {
+     sd(x)/sqrt(length(x))
+ }
> bplot = function(x, y, ylab = "") {
+     mu. = tapply(y, x, mean)
+     se. = tapply(y, x, se)
+     barplot2(mu., plot.ci = TRUE, ci.u = mu. + se., ci.l = mu. - 
+         se., las = 2, ylab = ylab)
+ }
> which.garden = function(x) {
+     x = unlist(strsplit(as.character(x), split = ".", fixed = TRUE))[1]
+     x = unlist(strsplit(x, split = ""))
+     if (length(x) < 3) {
+         x = "ONC"
+     }
+     else {
+         x = "PIT"
+     }
+     return(x)
+ }
> lco2quad = function(x) {
+     com = x[, -1:-6]
+     com = apply(com, 1, sum)
+     x = x[, 5:6]
+     out = array(0, dim = c(max(x), max(x)))
+     for (i in (1:nrow(x))) {
+         out[x[i, 1], x[i, 2]] = com[i]
+     }
+     return(out)
+ }
\end{Sinput}
\end{Schunk}

\subsection{Data Summary}
NOTE: there was a data entry error for tree N4.30, changed 11 to 1 in LCO_data_ONC_PIT.csv.

\begin{Schunk}
\begin{Sinput}
> lco = read.csv("data/LCO_data_ONC_PIT.csv")
\end{Sinput}
\end{Schunk}


\begin{Schunk}
\begin{Sinput}
> xtable(summary(lco[, 1:6]), table.placement = "tbp")
\end{Sinput}
% latex table generated in R 2.12.1 by xtable 1.5-6 package
% Sun Jul 24 14:29:47 2011
\begin{table}[ht]
\begin{center}
\begin{tabular}{rllllll}
  \hline
 &      Tree &      Geno &      Year &   Quadrat &      Row &      Col \\ 
  \hline
1 & N1.10  : 100   & 996    :1000   & Min.   :2010   & n45.55:4850   & Min.   : 1.0   & Min.   : 1.0   \\ 
  2 & N1.11  : 100   & 1008   : 900   & 1st Qu.:2011   & n80.90:3050   & 1st Qu.: 3.0   & 1st Qu.: 3.0   \\ 
  3 & N1.24  : 100   & 1017   : 750   & Median :2011   &  & Median : 5.5   & Median : 5.5   \\ 
  4 & N1.27  : 100   & 11     : 700   & Mean   :2011   &  & Mean   : 5.5   & Mean   : 5.5   \\ 
  5 & N1.28  : 100   & 10     : 600   & 3rd Qu.:2011   &  & 3rd Qu.: 8.0   & 3rd Qu.: 8.0   \\ 
  6 & N1.31  : 100   & 1023   : 600   & Max.   :2011   &  & Max.   :10.0   & Max.   :10.0   \\ 
  7 & (Other):7300   & (Other):3350   &  &  &  &  \\ 
   \hline
\end{tabular}
\end{center}
\end{table}\end{Schunk}

\begin{Schunk}
\begin{Sinput}
> xtable(summary(lco[, 7:10]), table.placement = "tbp")
\end{Sinput}
% latex table generated in R 2.12.1 by xtable 1.5-6 package
% Sun Jul 24 14:29:47 2011
\begin{table}[ht]
\begin{center}
\begin{tabular}{rllll}
  \hline
 &      Xgal &      Csub &      Lsp &      Chol \\ 
  \hline
1 & Min.   :0.0000   & Min.   :0.00000   & Min.   :0.00000   & Min.   :0.000000   \\ 
  2 & 1st Qu.:0.0000   & 1st Qu.:0.00000   & 1st Qu.:0.00000   & 1st Qu.:0.000000   \\ 
  3 & Median :1.0000   & Median :0.00000   & Median :0.00000   & Median :0.000000   \\ 
  4 & Mean   :0.5084   & Mean   :0.09165   & Mean   :0.02076   & Mean   :0.009494   \\ 
  5 & 3rd Qu.:1.0000   & 3rd Qu.:0.00000   & 3rd Qu.:0.00000   & 3rd Qu.:0.000000   \\ 
  6 & Max.   :1.0000   & Max.   :1.00000   & Max.   :1.00000   & Max.   :1.000000   \\ 
   \hline
\end{tabular}
\end{center}
\end{table}\end{Schunk}

\begin{Schunk}
\begin{Sinput}
> xtable(summary(lco[, 13:ncol(lco)]), table.placement = "tbp")
\end{Sinput}
% latex table generated in R 2.12.1 by xtable 1.5-6 package
% Sun Jul 24 14:29:47 2011
\begin{table}[ht]
\begin{center}
\begin{tabular}{rlll}
  \hline
 &      Pads &      Pund &      Rsp \\ 
  \hline
1 & Min.   :0.000000   & Min.   :0.000000   & Min.   :0.000000   \\ 
  2 & 1st Qu.:0.000000   & 1st Qu.:0.000000   & 1st Qu.:0.000000   \\ 
  3 & Median :0.000000   & Median :0.000000   & Median :0.000000   \\ 
  4 & Mean   :0.002532   & Mean   :0.002025   & Mean   :0.002532   \\ 
  5 & 3rd Qu.:0.000000   & 3rd Qu.:0.000000   & 3rd Qu.:0.000000   \\ 
  6 & Max.   :1.000000   & Max.   :1.000000   & Max.   :1.000000   \\ 
   \hline
\end{tabular}
\end{center}
\end{table}\end{Schunk}

\subsection{Separate Community Matrixes by Tree}
\begin{Schunk}
\begin{Sinput}
> lco = lco[lco$Quadrat == "n45.55", ]
> lco.l = list()
> tree.names = as.character(unique(lco$Tree))
\end{Sinput}
\end{Schunk}

\begin{Schunk}
\begin{Sinput}
> for (i in (1:length(tree.names))) {
+     lco.l[[i]] = lco[lco$Tree == tree.names[i], ]
+ }
> names(lco.l) = tree.names
> any(table(tree.names) != 1)
\end{Sinput}
\begin{Soutput}
[1] FALSE
\end{Soutput}
\end{Schunk}

\subsection{Separate garden, genotype and community data}
\begin{Schunk}
\begin{Sinput}
> garden = sapply(tree.names, which.garden)
> geno = unlist(lapply(lco.l, function(x) as.character(x$Geno[1])))
> com.l = lapply(lco.l, function(x) x[, (1:ncol(x))[colnames(x) == 
+     "Xgal"]:ncol(x)])
\end{Sinput}
\end{Schunk}

\subsection{Convert to Quadrat View}

\begin{Schunk}
\begin{Sinput}
> quad.l = lapply(lco.l, lco2quad)
\end{Sinput}
\end{Schunk}

\begin{Schunk}
\begin{Sinput}
> zero.na = function(x) {
+     x[is.na(x)] = 0
+     return(x)
+ }
> cor.l = lapply(com.l, kendall.pairs, alpha = 0.05)
> cor.l = lapply(cor.l, zero.na)
\end{Sinput}
\end{Schunk}

\section{Network Statistics}

\begin{Schunk}
\begin{Sinput}
> n = unlist(lapply(cor.l, function(x) length(apply(x, 1, sum)[abs(apply(x, 
+     1, sum)) > 0])))
> L = unlist(lapply(cor.l, function(x) length(x[x != 0])/2))
> C = L/(n * (n - 1))
> C[is.na(C)] = 0
> abs.cor.l = lapply(cor.l, abs)
> C.f = unlist(lapply(abs.cor.l, function(x) centralization(x, 
+     degree, mode = "graph")))
> aov.n = aov(sqrt(n) ~ factor(geno) * factor(garden))
> aov.L = aov(sqrt(L) ~ factor(geno) * factor(garden))
> aov.C = aov(C ~ factor(geno) * factor(garden))
> aov.Cf = aov(C.f ~ factor(geno) * factor(garden))
> aov.list = list(aov.n, aov.L, aov.C, aov.Cf)
\end{Sinput}
\end{Schunk}

\begin{Schunk}
\begin{Sinput}
> for (i in (1:length(aov.list))) {
+     print(xtable(summary(aov.list[[i]])))
+ }
\end{Sinput}
% latex table generated in R 2.12.1 by xtable 1.5-6 package
% Sun Jul 24 14:29:50 2011
\begin{table}[ht]
\begin{center}
\begin{tabular}{lrrrrr}
  \hline
 & Df & Sum Sq & Mean Sq & F value & Pr($>$F) \\ 
  \hline
factor(geno)                & 13 & 11.89 & 0.91 & 1.38 & 0.1906 \\ 
  factor(garden)              & 1 & 1.33 & 1.33 & 2.01 & 0.1605 \\ 
  factor(geno):factor(garden) & 9 & 4.95 & 0.55 & 0.83 & 0.5917 \\ 
  Residuals                   & 73 & 48.44 & 0.66 &  &  \\ 
   \hline
\end{tabular}
\end{center}
\end{table}
% latex table generated in R 2.12.1 by xtable 1.5-6 package
% Sun Jul 24 14:29:50 2011
\begin{table}[ht]
\begin{center}
\begin{tabular}{lrrrrr}
  \hline
 & Df & Sum Sq & Mean Sq & F value & Pr($>$F) \\ 
  \hline
factor(geno)                & 13 & 7.80 & 0.60 & 1.08 & 0.3899 \\ 
  factor(garden)              & 1 & 1.07 & 1.07 & 1.93 & 0.1695 \\ 
  factor(geno):factor(garden) & 9 & 4.53 & 0.50 & 0.91 & 0.5255 \\ 
  Residuals                   & 73 & 40.56 & 0.56 &  &  \\ 
   \hline
\end{tabular}
\end{center}
\end{table}
% latex table generated in R 2.12.1 by xtable 1.5-6 package
% Sun Jul 24 14:29:50 2011
\begin{table}[ht]
\begin{center}
\begin{tabular}{lrrrrr}
  \hline
 & Df & Sum Sq & Mean Sq & F value & Pr($>$F) \\ 
  \hline
factor(geno)                & 13 & 1.27 & 0.10 & 2.34 & 0.0116 \\ 
  factor(garden)              & 1 & 0.06 & 0.06 & 1.48 & 0.2276 \\ 
  factor(geno):factor(garden) & 9 & 0.38 & 0.04 & 1.00 & 0.4479 \\ 
  Residuals                   & 73 & 3.05 & 0.04 &  &  \\ 
   \hline
\end{tabular}
\end{center}
\end{table}
% latex table generated in R 2.12.1 by xtable 1.5-6 package
% Sun Jul 24 14:29:50 2011
\begin{table}[ht]
\begin{center}
\begin{tabular}{lrrrrr}
  \hline
 & Df & Sum Sq & Mean Sq & F value & Pr($>$F) \\ 
  \hline
factor(geno)                & 13 & 0.04 & 0.00 & 0.88 & 0.5777 \\ 
  factor(garden)              & 1 & 0.00 & 0.00 & 0.71 & 0.4025 \\ 
  factor(geno):factor(garden) & 9 & 0.03 & 0.00 & 0.89 & 0.5419 \\ 
  Residuals                   & 73 & 0.24 & 0.00 &  &  \\ 
   \hline
\end{tabular}
\end{center}
\end{table}\end{Schunk}

\subsection{Assumptions}

\begin{Schunk}
\begin{Sinput}
> shapiro.test(residuals(aov.n))
\end{Sinput}
\begin{Soutput}
	Shapiro-Wilk normality test

data:  residuals(aov.n) 
W = 0.9618, p-value = 0.006438
\end{Soutput}
\begin{Sinput}
> shapiro.test(residuals(aov.L))
\end{Sinput}
\begin{Soutput}
	Shapiro-Wilk normality test

data:  residuals(aov.L) 
W = 0.954, p-value = 0.001868
\end{Soutput}
\begin{Sinput}
> shapiro.test(residuals(aov.C))
\end{Sinput}
\begin{Soutput}
	Shapiro-Wilk normality test

data:  residuals(aov.C) 
W = 0.971, p-value = 0.03004
\end{Soutput}
\begin{Sinput}
> shapiro.test(n)
\end{Sinput}
\begin{Soutput}
	Shapiro-Wilk normality test

data:  n 
W = 0.7538, p-value = 1.871e-11
\end{Soutput}
\begin{Sinput}
> shapiro.test(L)
\end{Sinput}
\begin{Soutput}
	Shapiro-Wilk normality test

data:  L 
W = 0.623, p-value = 2.048e-14
\end{Soutput}
\begin{Sinput}
> shapiro.test(C)
\end{Sinput}
\begin{Soutput}
	Shapiro-Wilk normality test

data:  C 
W = 0.701, p-value = 9.296e-13
\end{Soutput}
\begin{Sinput}
> hist(residuals(aov.n))
> hist(residuals(aov.L))
> hist(residuals(aov.C))
> qqnorm(residuals(aov.C))
> hist(residuals(aov.n))
> hist(residuals(aov.L))
> hist(residuals(aov.C))
> fligner.test(n ~ factor(geno))
\end{Sinput}
\begin{Soutput}
	Fligner-Killeen test of homogeneity of variances

data:  n by factor(geno) 
Fligner-Killeen:med chi-squared = 12.53, df = 13, p-value = 0.4847
\end{Soutput}
\begin{Sinput}
> fligner.test(L ~ factor(geno))
\end{Sinput}
\begin{Soutput}
	Fligner-Killeen test of homogeneity of variances

data:  L by factor(geno) 
Fligner-Killeen:med chi-squared = 14.1747, df = 13, p-value = 0.3617
\end{Soutput}
\begin{Sinput}
> fligner.test(C ~ factor(geno))
\end{Sinput}
\begin{Soutput}
	Fligner-Killeen test of homogeneity of variances

data:  C by factor(geno) 
Fligner-Killeen:med chi-squared = 15.8931, df = 13, p-value = 0.2549
\end{Soutput}
\end{Schunk}

\section{Plots}


\subsection{Barplots}

Mean graphs for each genotype.

\begin{Schunk}
\begin{Sinput}
> geno.net = list()
> for (i in (1:length(unique(geno)))) {
+     x = cor.l[geno == unique(geno)[i]]
+     geno.net[[i]] = x[[1]]
+     for (j in (2:length(x))) {
+         geno.net[[i]] = geno.net[[i]] + x[[j]]
+     }
+     geno.net[[i]] = geno.net[[i]]/length(x)
+ }
> names(geno.net) = unique(geno)
\end{Sinput}
\end{Schunk}



\begin{Schunk}
\begin{Sinput}
> quartz(width = 7, height = 15)
> par(mfrow = c(5, 3))
> for (i in (1:length(geno.net))) {
+     gplot(abs(geno.net[[i]]), gmode = "graph", displaylabels = FALSE, 
+         mode = "circle", main = names(geno.net)[i])
+ }
\end{Sinput}
\end{Schunk}
\includegraphics{LCO_analyses-015}

\begin{Schunk}
\begin{Sinput}
> gplot(abs(geno.net[[2]]), gmode = "graph", displaylabels = TRUE, 
+     mode = "circle")
\end{Sinput}
\end{Schunk}
\includegraphics{LCO_analyses-016}

\begin{Schunk}
\begin{Sinput}
> gplot(abs(geno.net[[3]]), gmode = "graph", displaylabels = TRUE, 
+     mode = "circle")
\end{Sinput}
\end{Schunk}
\includegraphics{LCO_analyses-017}

\begin{Schunk}
\begin{Sinput}
> gplot(abs(geno.net[[4]]), gmode = "graph", displaylabels = TRUE, 
+     mode = "circle")
\end{Sinput}
\end{Schunk}
\includegraphics{LCO_analyses-018}

\begin{Schunk}
\begin{Sinput}
> gplot(abs(geno.net[[5]]), gmode = "graph", displaylabels = TRUE, 
+     mode = "circle")
\end{Sinput}
\end{Schunk}
\includegraphics{LCO_analyses-019}

\begin{Schunk}
\begin{Sinput}
> gplot(abs(geno.net[[6]]), gmode = "graph", displaylabels = TRUE, 
+     mode = "circle")
\end{Sinput}
\end{Schunk}
\includegraphics{LCO_analyses-020}

\begin{Schunk}
\begin{Sinput}
> gplot(abs(geno.net[[7]]), gmode = "graph", displaylabels = TRUE, 
+     mode = "circle")
\end{Sinput}
\end{Schunk}
\includegraphics{LCO_analyses-021}

\begin{Schunk}
\begin{Sinput}
> gplot(abs(geno.net[[8]]), gmode = "graph", displaylabels = TRUE, 
+     mode = "circle")
\end{Sinput}
\end{Schunk}
\includegraphics{LCO_analyses-022}

\begin{Schunk}
\begin{Sinput}
> gplot(abs(geno.net[[9]]), gmode = "graph", displaylabels = TRUE, 
+     mode = "circle")
\end{Sinput}
\end{Schunk}
\includegraphics{LCO_analyses-023}

\begin{Schunk}
\begin{Sinput}
> gplot(abs(geno.net[[10]]), gmode = "graph", displaylabels = TRUE, 
+     mode = "circle")
\end{Sinput}
\end{Schunk}
\includegraphics{LCO_analyses-024}

\begin{Schunk}
\begin{Sinput}
> gplot(abs(geno.net[[11]]), gmode = "graph", displaylabels = TRUE, 
+     mode = "circle")
\end{Sinput}
\end{Schunk}
\includegraphics{LCO_analyses-025}

\begin{Schunk}
\begin{Sinput}
> gplot(abs(geno.net[[12]]), gmode = "graph", displaylabels = TRUE, 
+     mode = "circle")
\end{Sinput}
\end{Schunk}
\includegraphics{LCO_analyses-026}

\begin{Schunk}
\begin{Sinput}
> gplot(abs(geno.net[[13]]), gmode = "graph", displaylabels = TRUE, 
+     mode = "circle")
\end{Sinput}
\end{Schunk}
\includegraphics{LCO_analyses-027}

\begin{Schunk}
\begin{Sinput}
> gplot(abs(geno.net[[14]]), gmode = "graph", displaylabels = TRUE, 
+     mode = "circle")
\end{Sinput}
\end{Schunk}
\includegraphics{LCO_analyses-028}



\subsection{Network Graphs}


%% <<fig=TRUE>>=
%% for (i in (1:length(cor.l))){
%%   gplot(abs(cor.l[[i]]),gmode='graph')
%% }
%% @ 

\end{document}  
